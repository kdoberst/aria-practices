<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Table Sorting Example | WAI-ARIA Authoring Practices 1.2</title>

    <!--  Core js and css shared by all examples; do not modify when using this template. -->
    <link
      rel="stylesheet"
      href="https://www.w3.org/StyleSheets/TR/2016/base.css"
    />
    <link rel="stylesheet" href="../css/core.css" />
    <script src="../js/examples.js"></script>
    <script src="../js/highlight.pack.js"></script>
    <script src="../js/app.js"></script>

    <!-- css for this example. -->
    <link href="css/table-sort.css" rel="stylesheet" />

    <!-- js for this example-->
    <script src="js/table-sort.js" type="text/javascript"></script>
  </head>
  <body>
    <nav aria-label="Related Links" class="feedback">
      <ul>
        <li>
          <a href="../../#browser_and_AT_support"
            >Browser and Assistive Technology Support</a
          >
        </li>
        <li>
          <a href="https://github.com/w3c/aria-practices/issues/new"
            >Report Issue</a
          >
        </li>
        <li>
          <a href="https://github.com/w3c/aria-practices/projects/16"
            >Related Issues</a
          >
        </li>
        <li><a href="../../#table">Design Pattern</a></li>
      </ul>
    </nav>
    <main>
      <h1>Table Sort Example</h1>
      <p>
        The below example illustrates an implementation of ARIA features to
        support data table column sorting.
      </p>
      <p>Similar examples include:</p>
      <ul>
        <li>
          <a href="../grid/dataGrids.html">Data Grid Examples</a>: Three example
          implementations of grid that include features relevant to presenting
          tabular information, such as content editing, sort, and column hiding.
        </li>
      </ul>

      <section>
        <div class="example-header">
          <h2 id="ex_label">Example</h2>
        </div>
        <div
          role="separator"
          id="ex_start_sep"
          aria-labelledby="ex_start_sep ex_label"
          aria-label="Start of"
        ></div>
        <div id="ex1">
          <table class="sortable" data-sort-table>
            <thead>
              <tr>
                <th scope="col">Name</th>
                <th scope="col">Year introduced</th>
                <th scope="col" data-no-sort>Season</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <th scope="row">First Kiss</th>
                <td>2017</td>
                <td>Early</td>
              </tr>
              <tr>
                <th scope="row">Honeycrisp</th>
                <td>1991</td>
                <td>Middle</td>
              </tr>
              <tr>
                <th scope="row">Haralson</th>
                <td>1922</td>
                <td>Late</td>
              </tr>
            </tbody>
          </table>
        </div>
        <div
          role="separator"
          id="ex_end_sep"
          aria-labelledby="ex_end_sep ex_label"
          aria-label="End of"
        ></div>
      </section>

      <!-- <script>
        const sortListener = (button) => {
          button.addEventListener('click', (event) => {
            const btn = event.target;

            const headerRow = btn.closest('tr');
            const headerCell = btn.closest('th');

            const columnIndex = Array.from(
              headerRow.querySelectorAll('th')
            ).indexOf(headerCell);

            const isAscending = setSortOrder(headerCell);

            const tbody = btn.closest('table').querySelector('tbody');
            Array.from(tbody.querySelectorAll('tr'))
              .sort(comparer(columnIndex, isAscending))
              .forEach((tr) => tbody.appendChild(tr));
          });
        };

        const setSortOrder = (th) => {
          const sortOrder =
            th.getAttribute('aria-sort') === 'ascending'
              ? 'descending'
              : 'ascending';

          Array.from(
            th.closest('tr').querySelectorAll('th')
          ).forEach((header) => header.removeAttribute('aria-sort'));

          th.setAttribute('aria-sort', sortOrder);
          return sortOrder === 'ascending';
        };

        const addSortButton = (th) => {
          const button = document.createElement('button');
          const buttonContent = document.createElement('span');

          while (th.firstChild) {
            buttonContent.appendChild(th.firstChild);
          }

          button.append(buttonContent);

          sortListener(button);
          th.append(button);
        };

        const getCellValue = (row, index) =>
          row.children[index].innerText || row.children[index].textContent;

        // https://stackoverflow.com/questions/14267781/sorting-html-table-with-javascript
        const comparer = (idx, asc) => (a, b) =>
          ((v1, v2) =>
            v1 !== '' && v2 !== '' && !isNaN(v1) && !isNaN(v2)
              ? v1 - v2
              : v1.toString().localeCompare(v2))(
            getCellValue(asc ? a : b, idx),
            getCellValue(asc ? b : a, idx)
          );

        document.querySelectorAll('table[data-sort-table]').forEach((table) => {
          const headerCells = table.querySelectorAll(
            'thead th:not([data-no-sort]'
          );
          headerCells.forEach((headerCell) => {
            addSortButton(headerCell);
          });
        });
      </script> -->

      <section>
        <h2 id="kbd_label">Keyboard Support</h2>
        <p>Not Applicable</p>
      </section>

      <section>
        <h2 id="rps_label">Role, Property, State, and Tabindex Attributes</h2>
        <table aria-labelledby="rps_label" class="data attributes">
          <thead>
            <tr>
              <th scope="col">Role</th>
              <th scope="col">Attribute</th>
              <th scope="col">Element</th>
              <th scope="col">Usage</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td></td>
              <th scope="row"><code>aria-sort=&quot;descending&quot;</code></th>
              <td>th</td>
              <td>Indicates that the column is currently sorted descending.</td>
            </tr>
            <tr>
              <td></td>
              <th scope="row"><code>aria-sort=&quot;ascending&quot;</code></th>
              <td>th</td>
              <td>Indicates that the column is currently sorted ascending.</td>
            </tr>
          </tbody>
        </table>
      </section>

      <section>
        <h2>Javascript and CSS Source Code</h2>
        <!--  After the js and css files are named with the name of this example, change the href and text of the following 2 links to refer to the appropriate js and css files.  -->
        <ul id="css_js_files">
          <li>
            CSS:
            <a href="css/table-sort.css" type="tex/css">table-sort.css</a>
          </li>
          <li>
            Javascript:
            <a href="js/table-sort.js" type="text/javascript">table-sort.js</a>
          </li>
        </ul>
      </section>

      <section>
        <h2 id="sc1_label">HTML Source Code</h2>
        <div
          role="separator"
          id="sc1_start_sep"
          aria-labelledby="sc1_start_sep sc1_label"
          aria-label="Start of"
        ></div>
        <pre><code id="sc1"></code></pre>
        <div
          role="separator"
          id="sc1_end_sep"
          aria-labelledby="sc1_end_sep sc1_label"
          aria-label="End of"
        ></div>
        <script>
          sourceCode.add('sc1', 'ex1', 'ex_label', 'css_js_files');
          sourceCode.make();
        </script>
      </section>
    </main>
    <nav>
      <a href="../../#table"
        >Table Design Pattern in WAI-ARIA Authoring Practices 1.2</a
      >
    </nav>
  </body>
</html>
